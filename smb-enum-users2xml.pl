#!/usr/bin/perl

print q(<?xml version="1.0" encoding="UTF-8"?>
<magictree class="MtBranchObject"><testdata class="MtBranchObject">);

print "<users>\n";

$first = 1;
$inuser = 0;

while (<STDIN>) {
	#|   UBUNTU05\backup (RID: 1068)
	if (/^\|\s{3}\w/) {
		if ($inuser && !$first){
			print "</user></domain>\n";
		}
		if ($first) { $first = 0 }
		$inuser = 1;
		/^\|\s{3}([\w|-]+)\\([\w|-]+)\s\(RID:\s(\d+)\)/;
		print "<domain>$1<user>$2<rid>$3</rid>";
	}

	if (/^\|\s{5}\w/) {
		#|     Full name:   backup
		if(/^\|\s{5}Full name:\s+(\w.*)$/) {
			print "<fullname>$1</fullname>";
		}
		#|     Flags:       Normal user account
		if(/^\|\s{5}Flags:\s+(\w.*)$/) {
			print "<flags>$1</flags>";
		}
	}
}

print "</user></domain>\n</users>\n";

print q(</testdata></magictree>);
print "\n";
